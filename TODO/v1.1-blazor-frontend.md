# üè∑Ô∏è Milestone: v1.1 ‚Äî Blazor WebAssembly Frontend

## Goal
Create a minimal Blazor WebAssembly UI that integrates with existing Auth & User microservices.

## Services in Play

- üß† **AuthService** ‚Üí Handles JWT authentication
- üë§ **UserService** ‚Üí Handles registration
- ü™µ **LoggerService** ‚Üí Logs user/auth activities
- üåê **BlazorWasm** ‚Üí Frontend client consuming APIs

---

## üåç Frontend Flow Overview

### Registration Flow
```
[Browser: BlazorWasm] ---> GET /register
    ‚Üì
    [UserService] ---> Register user
        ‚Ü≥ Publishes user.activity
        ‚Ü≥ Triggers token creation in AuthService
    ‚Üì
    [AuthService] ---> Issues JWT
        ‚Ü≥ Stores token in Redis
        ‚Ü≥ Publishes auth.activity
    ‚Üì
    [BlazorWasm] ---> Stores token (localStorage)
    ‚Üì
    Redirects ‚Üí /home
```

### Login Flow
```
[Browser: BlazorWasm] ---> POST /login
    ‚Üì
    [AuthService] ---> Validates credentials
        ‚Ü≥ Issues JWT
        ‚Ü≥ Publishes auth.activity & user.activity
    ‚Üì
    [BlazorWasm] ---> Stores token (localStorage)
    ‚Üì
    Redirects ‚Üí /home
```

---

## üß© Tech Stack

| Layer | Technology | Purpose |
|-------|-----------|---------|
| Frontend | Blazor WebAssembly (.NET 8) | Client-side SPA |
| API Calls | HttpClient + Refit (optional) | REST API communication |
| Auth | JWT Bearer (localStorage) | Token-based authentication |
| State Management | AuthenticationStateProvider | Auth context |
| UI | MudBlazor | Clean, modern UI components |
| Logging | Serilog (console + file) | Activity logs |
| Dev | Docker Compose | Same network as backend APIs |

---

## üìÅ Project Structure

```
src/
‚îú‚îÄ‚îÄ AuthService/
‚îú‚îÄ‚îÄ UserService/
‚îú‚îÄ‚îÄ LoggerService/
‚îú‚îÄ‚îÄ Shared/
‚îî‚îÄ‚îÄ BlazorWasm/                     # New project
    ‚îú‚îÄ‚îÄ BlazorWasm.csproj
    ‚îú‚îÄ‚îÄ Pages/
    ‚îÇ   ‚îú‚îÄ‚îÄ Register.razor
    ‚îÇ   ‚îú‚îÄ‚îÄ Login.razor
    ‚îÇ   ‚îú‚îÄ‚îÄ Home.razor
    ‚îÇ   ‚îî‚îÄ‚îÄ _Imports.razor
    ‚îú‚îÄ‚îÄ Services/
    ‚îÇ   ‚îú‚îÄ‚îÄ AuthApiClient.cs
    ‚îÇ   ‚îú‚îÄ‚îÄ UserApiClient.cs
    ‚îÇ   ‚îî‚îÄ‚îÄ TokenService.cs
    ‚îú‚îÄ‚îÄ Models/
    ‚îÇ   ‚îú‚îÄ‚îÄ LoginRequest.cs
    ‚îÇ   ‚îú‚îÄ‚îÄ RegisterRequest.cs
    ‚îÇ   ‚îî‚îÄ‚îÄ AuthResponse.cs
    ‚îú‚îÄ‚îÄ Providers/
    ‚îÇ   ‚îî‚îÄ‚îÄ CustomAuthStateProvider.cs
    ‚îú‚îÄ‚îÄ wwwroot/
    ‚îÇ   ‚îî‚îÄ‚îÄ appsettings.json
    ‚îú‚îÄ‚îÄ Program.cs
    ‚îî‚îÄ‚îÄ App.razor
```

---

## ü™ú Development TODO (v1.1)

### 1Ô∏è‚É£ Setup Project

- [ ] Create new Blazor WebAssembly project:
```bash
dotnet new blazorwasm -n BlazorWasm -o src/BlazorWasm
```

- [ ] Add MudBlazor:
```bash
dotnet add src/BlazorWasm package MudBlazor
dotnet add src/BlazorWasm package MudBlazor.Services
```

- [ ] Add Microsoft.AspNetCore.Components.Authorization
- [ ] Add System.Net.Http.Json for API calls

### 2Ô∏è‚É£ Configuration

- [ ] Create `wwwroot/appsettings.json`:
```json
{
  "ApiUrls": {
    "UserService": "http://localhost:5001/api/user",
    "AuthService": "http://localhost:5002/api/auth"
  }
}
```

- [ ] Inject configuration in `Program.cs`:
```csharp
builder.Services.AddScoped(sp => new HttpClient { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
builder.Services.AddScoped<AuthApiClient>();
builder.Services.AddScoped<UserApiClient>();
builder.Services.AddScoped<TokenService>();
builder.Services.AddAuthorizationCore();
builder.Services.AddScoped<AuthenticationStateProvider, CustomAuthStateProvider>();
builder.Services.AddMudServices();
```

### 3Ô∏è‚É£ Auth Flow Implementation

#### üîπ Register.razor
- [ ] Form with Username + Password
- [ ] On submit ‚Üí call `UserApiClient.RegisterAsync()`
- [ ] Wait for token validation event ‚Üí redirect `/home`

#### üîπ Login.razor
- [ ] Form with Username + Password
- [ ] On submit ‚Üí call `AuthApiClient.LoginAsync()`
- [ ] Save JWT to localStorage
- [ ] Redirect `/home`

#### üîπ Home.razor
- [ ] Display welcome message
- [ ] Optionally fetch user profile using JWT

### 4Ô∏è‚É£ Token Management

- [ ] **TokenService.cs**
    - Handles store/retrieve token from localStorage

- [ ] **CustomAuthStateProvider.cs**
    - Uses token from localStorage
    - Provides ClaimsPrincipal for UI state

### 5Ô∏è‚É£ Routing and Guard

- [ ] Protect `/home` using `[Authorize]`
- [ ] Allow `/login` and `/register` anonymously

### 6Ô∏è‚É£ Integration & Testing

- [ ] Run all microservices + BlazorWasm in Docker network
- [ ] Test:
    - ‚úÖ Register ‚Üí validated token ‚Üí home
    - ‚úÖ Login ‚Üí authenticate ‚Üí home
- [ ] Verify that JWT is stored and applied on protected endpoints

### 7Ô∏è‚É£ Tagging

After successful integration:

```bash
git add .
git commit -m "feat(frontend): add Blazor WebAssembly frontend for registration and login flow"
git tag -a v1.1-blazor-frontend -m "Blazor WASM frontend integrated with Auth & User services"
git push origin v1.1-blazor-frontend
```

---

## üìù Notes

- Ensure all microservices are running and accessible before testing the frontend
- JWT tokens should be validated on each protected API call
- Consider implementing token refresh mechanism for production
- Logger service will capture all authentication and user activity events